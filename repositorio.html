<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Repositorio - Charolas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        :root { --primary: #0A2342; --secondary: #2C4C6B; --accent: #4A89C5; --light: #F5F9FF; --white: #FFFFFF; --gray: #E8EEF2; --dominos: #00A5B0; --starbucks: #006241; --danger: #E74C3C; }
        body { background: var(--gray); padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 10px; padding: 25px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 3px solid var(--accent); padding-bottom: 15px; }
        .header h1 { color: var(--primary); } .header span { color: var(--accent); }
        .stats-container { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-card { background: linear-gradient(135deg,var(--light),white); padding: 10px 20px; border-radius: 10px; border-left: 5px solid var(--accent); flex: 1 1 180px; }
        .stat-card.dominos { border-left-color: var(--dominos); }
        .stat-card.starbucks { border-left-color: var(--starbucks); }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; color: var(--secondary); font-weight: 600; }
        .stat-number { font-size: 1.6rem; font-weight: 700; color: var(--primary); }
        .table-responsive { overflow-x: auto; border: 1px solid var(--gray); border-radius: 12px; max-height: 400px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1200px; }
        th { background: var(--primary); color: white; padding: 12px; font-size: 0.75rem; text-transform: uppercase; position: sticky; top: 0; }
        td { padding: 10px; border-bottom: 1px solid var(--gray); }
        .btn { padding: 8px 16px; border: none; border-radius: 8px; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; cursor: pointer; }
        .btn-info { background: var(--accent); color: white; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: #27AE60; color: white; }
        .btn-warning { background: #F39C12; color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .badge-turno { background: var(--primary); color: white; padding: 2px 8px; border-radius: 20px; font-size: 0.65rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Registro de <span>Charolas</span></h1>
            <div>
                <button class="btn btn-info" onclick="window.location.href='formulario.html'">üìù NUEVO</button>
                <button class="btn btn-primary" onclick="cargarDatos()">üîÑ ACTUALIZAR</button>
            </div>
        </div>
        <div class="stats-container" id="statsContainer">
            <div class="stat-card"><div class="stat-label">Registros HOY</div><div class="stat-number" id="totalRegistrosHoy">0</div></div>
            <div class="stat-card dominos"><div class="stat-label">DOMINO'S HOY</div><div class="stat-number" id="totalDominosHoy">0</div></div>
            <div class="stat-card starbucks"><div class="stat-label">STARBUCKS HOY</div><div class="stat-number" id="totalStarbucksHoy">0</div></div>
            <div class="stat-card"><div class="stat-label">Tiendas HOY</div><div class="stat-number" id="totalTiendasHoy">0</div></div>
        </div>
        <div class="table-responsive">
            <table id="tablaRepositorio">
                <thead><tr><th>Fecha</th><th>Turno</th><th>Empleado</th><th>Ruta</th><th>Bit√°cora</th><th>Unidad</th><th>Tiendas</th><th>Domino's</th><th>Starbucks</th><th>Ver</th></tr></thead>
                <tbody id="tablaBody"></tbody>
            </table>
        </div>
    </div>
    <script>
        function cargarDatos() {
            const data = JSON.parse(localStorage.getItem('repositorioCharolas'))||[];
            let html = '', td=0, ts=0, tr=0, tt=0;
            data.sort((a,b)=>new Date(b.fechaCaptura)-new Date(a.fechaCaptura));
            data.forEach(r=>{
                let d = parseInt(r.resumen?.totalDominos)||0, s = parseInt(r.resumen?.totalStarbucks)||0, t = r.resumen?.totalTiendas||0;
                let turno = r.turno?.includes('PRIMERO')?'PRIMERO':r.turno?.includes('SEGUNDO')?'SEGUNDO':'TERCERO';
                html+=`<tr><td>${r.fechaCaptura||''}</td><td><span class="badge-turno">${turno}</span></td><td>${r.datosGenerales?.noEmpleado||''}</td><td>${r.datosGenerales?.ruta||''}</td><td>${r.datosGenerales?.bitacora||''}</td><td>${r.datosGenerales?.unidad||''}</td><td>${t}</td><td>${d}</td><td>${s}</td><td><button class="btn btn-info" style="padding:2px 8px;font-size:0.7rem;" onclick="verDetalle('${r.id}')">VER</button></td></tr>`;
                if(new Date(r.fechaCaptura).toDateString()===new Date().toDateString()) { tr++; td+=d; ts+=s; tt+=t; }
            });
            document.getElementById('tablaBody').innerHTML = html||'<tr><td colspan="10" style="text-align:center;padding:50px;">üì≠ Sin registros</td></tr>';
            document.getElementById('totalRegistrosHoy').textContent = tr;
            document.getElementById('totalDominosHoy').textContent = td;
            document.getElementById('totalStarbucksHoy').textContent = ts;
            document.getElementById('totalTiendasHoy').textContent = tt;
        }
        function verDetalle(id) {
            let r = JSON.parse(localStorage.getItem('repositorioCharolas')).find(x=>x.id===id);
            let m = `üìã DETALLE\nFecha: ${r.fechaCaptura}\nEmpleado: ${r.datosGenerales.noEmpleado}\nRuta: ${r.datosGenerales.ruta}\nUnidad: ${r.datosGenerales.unidad}\nComentarios: ${r.datosGenerales.comentarios}\n\nTIENDAS:\n`;
            r.registros.forEach((t,i)=> m+=`${i+1}. ${t.tienda} | Cant:${t.cantidadBitacora} | Dif:${t.diferencia} | Fis:${t.cantidadFisica} | ${t.tipo}\n`);
            alert(m);
        }
        document.addEventListener('DOMContentLoaded',cargarDatos);
        setInterval(cargarDatos,30000);
    </script>
</body>
</html>